heart_beat() is not shadowable

-----

need a way to tell the driver to try reconnecting to the addr_server
after it has gone down and come back up (the addr_server).  maybe
the driver could just retry every now and then?

--john

-----

read_file() doesn't guarantee that a "/" is at the start of the filename
before passing to valid_read()...same problem might exist with
write_file(), read_bytes(), write_bytes(), didn't check yet

(ucs_brf@pip.shsu.edu)

Comment:
    This problem is rather common in the driver currently.  Internally,
    filenames have no leading '/'.  One should probably be added every time
    a filename is passed to the mudlib.

-----

hm, Linux apparently doesn't let you open a directory for reading. boggle.
so all the efuns that read from a file will screw up if you try
to use a dir as the file.  ack

ucs_brf@pip.shsu.edu

-----

    sprintf.c should probably be rewritten as it has a nasty habit of
    munging the stack and writing to places without checking the destination
    type if it's ok; probably should also remove need for setjmp/longjmp;
    also: err = setjmp(...) is non strict ANSI portable according to SAS
    tech support for their C compiler (SAS/C)

-----

    mixed a;
    do {} while (a = ({ a, "" }));

Profezzorn@TMI-2

Comment:
    It would be nice if things like this, where all the memory (VM too)
    is sucked up by a runaway program, didn't cause the driver to
    shutdown ("Out of memory").

-----

Currently, binaries are not checked to see if they are out of date with
respect to the simul_efun object, causing wierd behavior of binaries of
the order of the simuls changes, and then a binary is loaded.

------

edit_source should check for the existence of a.out to see if compilation
succeeded.  The exit code of the compiler is correct alot, but not on
all systems.  Should probably use -o somefile instead of assuming a.out
as well.

-----

Line numbers get messed up when files don't end in a newline?

-----

anonymous function pointers don't work in LPC->C

-----

Range/switch search should be binary, not linear. (in LPC->C)

-----

strings longer than MAXSHORT screw up statistics, b/c their length is counted
inconsistently.

-----

Connected to address server on localhost port 6364
secure/master/compile.c line 37: Undefined variable 'ob'

secure/master/compile.c line 44: parse error
secure/master/compile.c line 49: Illegal LHS
secure/master/compile.c line 56: Illegal LHS
secure/master/compile.c line 56: parse error
secure/master/compile.c line 70: Illegal LHS
MDfree: right side of entry corrupt: reallocate_locals:2 0220
MDfree: right side of entry corrupt: reallocate_locals:3 400617d8
Segmentation fault (core dumped)

(gdb) where

#0  0xb7b30 in deactivate_current_locals () at compiler.c:141
#1  0x2e9d4 in yyparse () at grammar.y.pre:2362
#2  0xbb9e8 in compile_file (f=4, name=0x7b033e60 "secure/master.c")
    at compiler.c:1220
#3  0x58c50 in load_object (lname=0x40056709 "secure/master", lpc_obj=0x0)
    at simulate.c:448
#4  0x40db8 in main (argc=2, argv=0x7b033a4c) at main.c:384

(gdb) print current_prog
$1 = (program_t *) 0x0
(gdb) print current_file
$2 = 0x40067248 "secure/master/security.c"
(gdb) print current_line
$3 = 99

Line 97-101 as follows:
-------------

int
valid_write( string file, object ob, string fun )
{
    string *ok;
-------------

The line that seems to cause the crash is the one that fails
in compile.c (line 44)

> if ( file_size(USER_SAVE_DIRS_V[type] nom[0..0]) != -2 )
(Spot the missing '+', adding that cures the crash.)
USER_SAVE_DIRS_V is a string *, nom is a string.

                            !A

-------

Probably need a test to see if bison's output actually compiles in
./build.Mudos;  on alot of AIX systems bison's use of alloca() fails.

-Beek

-------

The current implementation of swapping could use alot of work.  Swapping
an object in/out isn't that expensive CPU wise, and can save a decent amount
of memory.  The problem is that cloned programs can't swap, which disables
swapping for much of the mud ...

-Beek

------

foreach() in LPC->C needs the foreach_depth fixes and some code for foreach
it also needs the loop generation cleanup

------

grep crasher again?
reclaim_objects() ?
-------

OSF crasher:

#0  0x12006387c in find_for_insert (m=0x14008f800, lv=0x11fffe9b0, doTheFree=1)
    at mapping.c:549
#1  0x120066cd0 in insert_in_mapping (m=0x14008f800,
    key=0x140011290 "arguments") at mapping.c:1388
#2  0x120067130 in add_mapping_array (m=0x14008f800,
    key=0x140011290 "arguments", value=0x140098a40) at mapping.c:1436
#3  0x120042684 in get_svalue_trace () at interpret.c:4159
#4  0x120049d08 in mudlib_error_handler (
    err=0x11fffeb08 "*Bad argument to [ .. ] range operator.\n", catch=0)
    at simulate.c:2097
#5  0x12004a18c in error_handler (
    err=0x11fffeb08 "*Bad argument to [ .. ] range operator.\n")
    at simulate.c:2169
#6  0x12004a424 in error (
    fmt=0x14001ae00 "Bad argument to [ .. ] range operator.\n")
    at simulate.c:2256
#7  0x1200bafe4 in f_range (code=0) at eoperators.c:724
#8  0x12003e74c in eval_instruction (p=0x14006515e "@") at interpret.c:2950
#9  0x120037108 in call_program (prog=0x140065040, offset=134)
    at interpret.c:1611
#10 0x120040218 in apply_low (fun=0x140099050 "prompt_password",
    ob=0x14007e280, num_arg=1) at interpret.c:3507
#11 0x120040388 in apply (fun=0x140099050 "prompt_password", ob=0x14007e280,
---Type <return> to continue, or q <return> to quit---
    num_arg=1, where=1) at interpret.c:3565
#12 0x12006cf70 in call_function_interactive (i=0x140080800,
    str=0x140046238 "o") at comm.c:1890
#13 0x12006b408 in process_user_command () at comm.c:1216
#14 0x120056584 in backend () at backend.c:239
#15 0x12002f388 in main (argc=2, argv=0x11ffffda8) at main.c:476
(gdb)

-------

!codefor int x = 1 + 1.2

0000: byte 2
0002: to_int 
0003: (void)assign_local LV0
0005: return_zero 

-------

Unterminated @@ block bug is back?
explode(read_file()) bug is back?

-------

There seems to be some really nasty behavior with respect to UDP failures;
this could be due to the mudlib continually retrying to send when it fails,
but CPU seems to race a bit.
